[{"name":"app.R","content":"library(shiny)\nlibrary(bslib)\n\nui <- page_sidebar(\n  title = \"Statistical Distribution Workbench\",\n  theme = bs_theme(bootswatch = \"morph\", primary = \"#2c3e50\"),\n  \n  sidebar = sidebar(\n    # 1. Distribution Selection\n    selectInput(\"dist\", \"Distribution:\",\n                choices = list(\n                  \"Continuous\" = c(\"Normal\", \"t\", \"F\", \"Exponential\", \"Uniform\", \"Beta\"),\n                  \"Discrete\" = c(\"Binomial\", \"Poisson\", \"Negative Binomial\", \"Geometric\")\n                )),\n    \n    uiOutput(\"params_ui\"),\n    hr(),\n    \n    # 2. Calculation Logic\n    radioButtons(\"calc_type\", \"Objective:\", \n                 choices = list(\"Find Probability\" = \"prob\", \"Find Quantile\" = \"quant\")),\n    \n    selectInput(\"tail_mode\", \"Interval Type:\", \n                choices = c(\"One-tailed\", \"Two-tailed\")),\n    \n    uiOutput(\"val_inputs\"),\n    \n    conditionalPanel(\n      condition = \"input.tail_mode == 'One-tailed'\",\n      radioButtons(\"tail_dir\", \"Direction:\",\n                   choices = list(\"Lower Tail (≤)\" = \"lower\", \"Upper Tail (>)\" = \"upper\"))\n    )\n  ),\n  \n  # Main Layout\n  layout_column_wrap(\n    width = 1/2,\n    card(\n      card_header(\"Statistical Claim\"),\n      div(style = \"font-size: 1.4rem; padding: 10px; color: #2c3e50; font-family: 'Courier New', monospace;\",\n          textOutput(\"claim_text\"))\n    ),\n    card(\n      card_header(\"Distribution Summary Stats\"),\n      tableOutput(\"summary_table\")\n    ),\n    card(\n      full_screen = TRUE,\n      card_header(\"Visualization\"),\n      plotOutput(\"dist_plot\")\n    )\n  )\n)\n\nserver <- function(input, output, session) {\n  \n  # --- Dynamic Inputs ---\n  output$params_ui <- renderUI({\n    d <- input$dist\n    if (d == \"Normal\") tagList(numericInput(\"mu\", \"Mean (μ):\", 0), numericInput(\"sigma\", \"SD (σ):\", 1, min = 0.01))\n    else if (d == \"t\") numericInput(\"df\", \"df:\", 10, min = 1)\n    else if (d == \"F\") tagList(numericInput(\"df1\", \"df1:\", 10, min = 1), numericInput(\"df2\", \"df2:\", 10, min = 1))\n    else if (d == \"Exponential\") numericInput(\"rate\", \"Rate (λ):\", 1, min = 0.01)\n    else if (d == \"Uniform\") tagList(numericInput(\"min\", \"Min (a):\", 0), numericInput(\"max\", \"Max (b):\", 1))\n    else if (d == \"Beta\") tagList(numericInput(\"s1\", \"Shape 1 (α):\", 2), numericInput(\"s2\", \"Shape 2 (β):\", 2))\n    else if (d == \"Binomial\") tagList(numericInput(\"size\", \"n:\", 20), numericInput(\"p_b\", \"p:\", 0.5, min=0, max=1))\n    else if (d == \"Poisson\") numericInput(\"lam\", \"λ:\", 5)\n    else if (d == \"Negative Binomial\") tagList(numericInput(\"nb_r\", \"Successes (r):\", 5), numericInput(\"nb_p\", \"Prob (p):\", 0.5))\n    else if (d == \"Geometric\") numericInput(\"g_p\", \"Prob (p):\", 0.5)\n  })\n  \n  output$val_inputs <- renderUI({\n    label <- if(input$calc_type == \"prob\") \"Value (x)\" else \"Prob (p)\"\n    if (input$tail_mode == \"One-tailed\") {\n      numericInput(\"v1\", label, value = 0.5)\n    } else {\n      tagList(\n        numericInput(\"v1\", paste(\"Lower\", label), value = 0.25),\n        numericInput(\"v2\", paste(\"Upper\", label), value = 0.75)\n      )\n    }\n  })\n  \n  # --- Helpers for Prob/Quantile ---\n  dist_func <- function(type, val, lower_tail = TRUE) {\n    d <- input$dist\n    if (type == \"p\") {\n      switch(d,\n             \"Normal\" = pnorm(val, input$mu, input$sigma, lower.tail=lower_tail),\n             \"t\" = pt(val, input$df, lower.tail=lower_tail),\n             \"F\" = pf(val, input$df1, input$df2, lower.tail=lower_tail),\n             \"Exponential\" = pexp(val, input$rate, lower.tail=lower_tail),\n             \"Uniform\" = punif(val, input$min, input$max, lower.tail=lower_tail),\n             \"Beta\" = pbeta(val, input$s1, input$s2, lower.tail=lower_tail),\n             \"Binomial\" = pbinom(val, input$size, input$p_b, lower.tail=lower_tail),\n             \"Poisson\" = ppois(val, input$lam, lower.tail=lower_tail),\n             \"Negative Binomial\" = pnbinom(val, input$nb_r, input$nb_p, lower.tail=lower_tail),\n             \"Geometric\" = pgeom(val, input$g_p, lower.tail=lower_tail)\n      )\n    } else {\n      switch(d,\n             \"Normal\" = qnorm(val, input$mu, input$sigma, lower.tail=lower_tail),\n             \"t\" = qt(val, input$df, lower.tail=lower_tail),\n             \"F\" = qf(val, input$df1, input$df2, lower.tail=lower_tail),\n             \"Exponential\" = qexp(val, input$rate, lower.tail=lower_tail),\n             \"Uniform\" = qunif(val, input$min, input$max, lower.tail=lower_tail),\n             \"Beta\" = qbeta(val, input$s1, input$s2, lower.tail=lower_tail),\n             \"Binomial\" = qbinom(val, input$size, input$p_b, lower.tail=lower_tail),\n             \"Poisson\" = qpois(val, input$lam, lower.tail=lower_tail),\n             \"Negative Binomial\" = qnbinom(val, input$nb_r, input$nb_p, lower.tail=lower_tail),\n             \"Geometric\" = qgeom(val, input$g_p, lower.tail=lower_tail)\n      )\n    }\n  }\n  \n  # --- Core Reactive Calculation ---\n  calc_res <- reactive({\n    req(input$v1)\n    is_prob <- (input$calc_type == \"prob\")\n    \n    if (input$tail_mode == \"One-tailed\") {\n      lt <- (input$tail_dir == \"lower\")\n      res <- dist_func(ifelse(is_prob, \"p\", \"q\"), input$v1, lt)\n      return(list(res = res, v1 = input$v1, v2 = NA))\n    } else {\n      req(input$v2)\n      validate(need(input$v2 > input$v1, \"Upper bound must be greater than lower bound\"))\n      if (is_prob) {\n        res <- dist_func(\"p\", input$v2) - dist_func(\"p\", input$v1)\n        return(list(res = res, v1 = input$v1, v2 = input$v2))\n      } else {\n        res1 <- dist_func(\"q\", input$v1)\n        res2 <- dist_func(\"q\", input$v2)\n        return(list(res = paste(round(res1, 3), \"to\", round(res2, 3)), v1 = res1, v2 = res2))\n      }\n    }\n  })\n  \n  # --- Summary Statistics Logic ---\n  output$summary_table <- renderTable({\n    d <- input$dist\n    stats <- list(Mean = NA, SD = NA, Var = NA, Median = NA)\n    \n    try({\n      if (d == \"Normal\") {\n        stats$Mean <- input$mu; stats$SD <- input$sigma; stats$Var <- input$sigma^2; stats$Median <- input$mu\n      } else if (d == \"t\") {\n        stats$Mean <- if(input$df > 1) 0 else \"Undefined\"; stats$Var <- if(input$df > 2) input$df/(input$df-2) else \"Infinite\"; stats$Median <- 0\n      } else if (d == \"Exponential\") {\n        stats$Mean <- 1/input$rate; stats$Var <- 1/input$rate^2; stats$Median <- log(2)/input$rate\n      } else if (d == \"Uniform\") {\n        stats$Mean <- (input$min+input$max)/2; stats$Var <- (input$max-input$min)^2/12; stats$Median <- stats$Mean\n      } else if (d == \"Binomial\") {\n        stats$Mean <- input$size * input$p_b; stats$Var <- stats$Mean * (1-input$p_b); stats$Median <- qbinom(0.5, input$size, input$p_b)\n      } else if (d == \"Poisson\") {\n        stats$Mean <- input$lam; stats$Var <- input$lam; stats$Median <- qpois(0.5, input$lam)\n      }\n      if(!is.character(stats$Var)) stats$SD <- sqrt(as.numeric(stats$Var))\n    }, silent = TRUE)\n    \n    data.frame(Statistic = names(stats), Value = as.character(round(unlist(stats), 4)))\n  }, colnames = FALSE)\n  \n  # --- Dynamic Claim Generator ---\n  output$claim_text <- renderText({\n    out <- calc_res()\n    d_name <- input$dist\n    \n    if (input$calc_type == \"prob\") {\n      if (input$tail_mode == \"One-tailed\") {\n        symb <- if(input$tail_dir == \"lower\") \"≤\" else \">\"\n        paste0(\"P(X \", symb, \" \", input$v1, \") ≈ \", round(out$res, 4))\n      } else {\n        paste0(\"P(\", input$v1, \" < X < \", input$v2, \") ≈ \", round(out$res, 4))\n      }\n    } else {\n      if (input$tail_mode == \"One-tailed\") {\n        symb <- if(input$tail_dir == \"lower\") \"≤\" else \">\"\n        paste0(\"If P(X \", symb, \" x) = \", input$v1, \", then x ≈ \", round(out$res, 4))\n      } else {\n        paste0(\"For middle probability between \", input$v1, \" and \", input$v2, \", interval ≈ [\", round(out$v1, 3), \", \", round(out$v2, 3), \"]\")\n      }\n    }\n  })\n  \n  # --- Visualization ---\n  output$dist_plot <- renderPlot({\n    out <- calc_res()\n    d <- input$dist\n    is_discrete <- d %in% c(\"Binomial\", \"Poisson\", \"Negative Binomial\", \"Geometric\")\n    \n    if(!is_discrete) {\n      # Custom logic for plotting ranges\n      x_min <- if(d==\"Normal\") input$mu - 4*input$sigma else if(d==\"Uniform\") input$min-0.2 else 0\n      x_max <- if(d==\"Normal\") input$mu + 4*input$sigma else if(d==\"Uniform\") input$max+0.2 else if(d==\"Beta\") 1 else 15\n      x_seq <- seq(x_min, x_max, length.out=400)\n      y_seq <- switch(d, \"Normal\"=dnorm(x_seq, input$mu, input$sigma), \"t\"=dt(x_seq, input$df), \"Exponential\"=dexp(x_seq, input$rate), \"Uniform\"=dunif(x_seq, input$min, input$max), \"Beta\"=dbeta(x_seq, input$s1, input$s2), \"F\"=df(x_seq, input$df1, input$df2))\n      \n      plot(x_seq, y_seq, type=\"l\", lwd=3, col=\"#2c3e50\", xlab=\"x\", ylab=\"f(x)\", main=paste(d, \"Distribution Density\"))\n      \n      x_crit1 <- if(input$calc_type == \"prob\") input$v1 else out$v1\n      x_crit2 <- if(input$calc_type == \"prob\") input$v2 else out$v2\n      \n      if(input$tail_mode == \"One-tailed\") {\n        mask <- if(input$tail_dir == \"lower\") x_seq <= x_crit1 else x_seq >= x_crit1\n      } else {\n        mask <- x_seq >= x_crit1 & x_seq <= x_crit2\n      }\n      polygon(c(min(x_seq[mask]), x_seq[mask], max(x_seq[mask])), c(0, y_seq[mask], 0), col=\"#18bc9c88\", border=NA)\n    } else {\n      x_max_d <- if(d==\"Binomial\") input$size else 25\n      x_vals <- 0:x_max_d\n      y_vals <- switch(d, \"Binomial\"=dbinom(x_vals, input$size, input$p_b), \"Poisson\"=dpois(x_vals, input$lam), \"Negative Binomial\"=dnbinom(x_vals, input$nb_r, input$nb_p), \"Geometric\"=dgeom(x_vals, input$g_p))\n      cols <- rep(\"#bdc3c7\", length(x_vals))\n      x_crit1 <- if(input$calc_type == \"prob\") input$v1 else out$v1\n      x_crit2 <- if(input$calc_type == \"prob\") input$v2 else out$v2\n      \n      if(input$tail_mode == \"One-tailed\") {\n        if(input$tail_dir == \"lower\") cols[x_vals <= x_crit1] <- \"#18bc9c\" else cols[x_vals > x_crit1] <- \"#18bc9c\"\n      } else {\n        cols[x_vals >= x_crit1 & x_vals <= x_crit2] <- \"#18bc9c\"\n      }\n      barplot(y_vals, names.arg=x_vals, col=cols, border=\"white\", main=paste(d, \"PMF\"))\n    }\n  })\n}\n\nshinyApp(ui, server)","type":"text"}]
